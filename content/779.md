Title: Pola zależne od stanu innych pól
Date: 2013-07-15 12:31
Author: filipgorczynski
Category: Programowanie, Rozwiązania
Slug: 779
Status: draft

\[code language="php"\]  
/\*\*  
\* Implements hook\_form().  
\* \@todo add removing fields  
\*/  
function loss\_report\_form(\$form, &\$form\_state) {  
\$categoryTree = LossReport::getCategoryTree();  
\$categories = LossReport::getLossCategories();  
\$form = array();  
\$form\['\#tree'\] = true;  
\$form\['\#attributes'\]\['enctype'\] = 'multipart/form-data';  
\$loss\_report\_general\_information = variable\_get('loss\_report\_general\_information', array(  
'value' =\> '',  
'format' =\> filter\_default\_format(),  
));  
\$form\['general\_information'\] = array(  
'\#markup' =\> \$loss\_report\_general\_information\['value'\],  
);  
\$form\['header\_1'\] = array(  
'\#markup' =\> '\<h2\>' . t('Select loss report') . '\</h2\>',  
);  
\$form\['loss\_categories'\] = array(  
'\#type' =\> 'select',  
'\#options' =\> array\_merge(array('' =\> t('-- Select category --')), \$categories),  
'\#default\_value' =\> !empty(\$form\_state\['loss\_categories'\])? \$form\_state\['loss\_categories'\]: '',  
'\#required' =\> true,  
);  
\$form\['header\_2'\] = array(  
'\#markup' =\> '\<h2\>' . t('Data injured') . '\</h2\>',  
);  
\$form\['loss\_report'\] = array(  
'firstname' =\> array(  
'\#type' =\> 'textfield',  
'\#attributes' =\> array('class' =\> 'input one-column'),  
'\#title' =\> t('First name'),  
'\#description' =\> t(''),  
'\#field\_prefix' =\> '\<p class="one-column"\>',  
'\#field\_suffix' =\> '\</p\>',  
'\#required' =\> true,  
),  
'lastname' =\> array(  
'\#type' =\> 'textfield',  
'\#attributes' =\> array('class' =\> 'input one-column'),  
'\#title' =\> t('Last name'),  
'\#description' =\> t(''),  
'\#field\_prefix' =\> '\<p class="one-column"\>',  
'\#field\_suffix' =\> '\</p\>',  
'\#required' =\> true,  
),  
'loss\_number' =\> array(  
'\#type' =\> 'textfield',  
'\#attributes' =\> array('class' =\> 'input one-column'),  
'\#title' =\> t('Loss number'),  
'\#field\_prefix' =\> '\<p class="one-column"\>',  
'\#field\_suffix' =\> '\</p\>',  
'\#description' =\> t(''),  
'\#required' =\> true,  
),  
'plate\_number' =\> array(  
'\#type' =\> 'textfield',  
'\#title' =\> t('Plate numbers'),  
'\#attributes' =\> array('class' =\> 'input one-column'),  
'\#field\_prefix' =\> '\<p class="one-column"\>',  
'\#field\_suffix' =\> '\</p\>',  
'\#description' =\> t(''),  
'\#required' =\> true,  
),  
'message' =\> array(  
'\#type' =\> 'textarea',  
'\#attributes' =\> array('class' =\> 'input two-columns'),  
'\#title' =\> t('Message'),  
'\#field\_prefix' =\> '\<p class="two-columns"\>',  
'\#field\_suffix' =\> '\</p\>',  
'\#description' =\> t(''),  
'\#required' =\> true,  
),  
);  
\$form\['header\_3'\] = array(  
'\#markup' =\> '\<h2\>' . t('Attachments') . '\</h2\>',  
);  
foreach (\$categories as \$cid =\> \$value) {  
\$form\["loss\_container\_{\$cid}"\] = array(  
'\#type' =\> 'container',  
'\#prefix' =\> '\<div id="edit-loss-container-' . \$cid . '" class="form-wrapper" style="display: none"\>',  
'\#suffix' =\> '\</div\>',  
'\#states' =\> array(  
'visible' =\> array(  
'select\[name="loss\_categories"\]' =\> array(  
'value' =\> \$cid  
),  
),  
),  
'files\_container' =\> array(  
'\#type' =\> 'fieldset',  
'\#title' =\> t('Files'),  
),  
);

foreach (\$categoryTree\[\$cid\]\['subcategory'\] as \$sid =\> \$names) {  
\$form\["loss\_container\_{\$cid}"\]\['files\_container'\]\["checkbox\_{\$cid}\_{\$sid}"\] = array(  
'\#type' =\> 'checkbox',  
'\#title' =\> \$names\[0\],  
'\#prefix' =\> '\<div\>',  
'\#suffix' =\> '\</div\>',  
);  
if (empty(\$form\_state\["add\_more\_file\_{\$cid}\_{\$sid}\_counter"\]))  
\$form\_state\["add\_more\_file\_{\$cid}\_{\$sid}\_counter"\] = 1;

\$cbx\_name = "loss\_container\_{\$cid}\[files\_container\]\[checkbox\_{\$cid}\_{\$sid}\]";  
\$cbx\_container = "edit-loss-container-{\$cid}-files-container-checkbox-{\$cid}-{\$sid}-cbx-container";  
\$files\_container = "edit-loss-container-{\$cid}-files-container-checkbox-{\$cid}-{\$sid}-files-container";

\$form\["loss\_container\_{\$cid}"\]\['files\_container'\]\["checkbox\_{\$cid}\_{\$sid}-cbx\_container"\] = array(  
'\#type' =\> 'container',  
'\#prefix' =\> '\<div id="' . \$cbx\_container . '" class="form-wrapper" style="display: none"\>',  
'\#suffix' =\> '\</div\>',  
'\#states' =\> array(  
'visible' =\> array(  
':input\[name="' . \$cbx\_name . '"\]' =\> array(  
'checked' =\> true  
),  
),  
),  
'files' =\> array(  
'\#type' =\> 'container',  
'\#prefix' =\> '\<div id="' . \$files\_container . '" class="form-wrapper"\>',  
'\#suffix' =\> '\</div\>',  
),  
"add\_more\_file\_{\$cid}\_{\$sid}" =\> array(  
'\#type' =\> 'submit',  
'\#name' =\> "add\_more\_file\_{\$cid}\_{\$sid}",  
'\#value' =\> t('Add another file'),  
'\#limit\_validation\_errors' =\> array(),  
'\#submit' =\> array('loss\_reports\_add\_more\_file'),  
'\#ajax' =\> array(  
'wrapper' =\> \$files\_container,  
'callback' =\> 'loss\_report\_add\_more\_callback',  
'method' =\> 'append',  
'effect' =\> 'fade',  
),  
),  
);

for (\$i = 1; \$i \<= \$form\_state\["add\_more\_file\_{\$cid}\_{\$cid}\_counter"\]; \$i++) {  
\$keys = array(  
"loss\_container\_{\$cid}",  
'files\_container',  
"checkbox\_{\$cid}\_{\$sid}-cbx\_container",  
'files',  
'file',  
);  
\$file\_field\[\$i\] = array(  
'\#type' =\> 'managed\_file',  
'\#title' =\> t('Add file'),  
'\#upload\_location' =\> 'public://',  
'\#upload\_validators' =\> array(  
'file\_validate\_extensions' =\> array('pdf doc docx xls xlsx txt gif png jpg jpeg'),  
'file\_validate\_size' =\> array(ini\_get('upload\_max\_filesize')),  
),  
);  
drupal\_array\_set\_nested\_value(\$form, \$keys, \$file\_field);  
}  
}  
}  
\$form\['submit'\] = array(  
'\#type' =\> 'submit',  
'\#value' =\> t('Send'),  
);  
return \$form;  
}

&nbsp;

\[/code\]

 

\[code language="php"\]  
function gf\_conditional\_form(\$form, &\$form\_state) {  
\$form\['drupal\_love'\] = array(  
'\#title' =\> t('Do you like Drupal?'),  
'\#type' =\> 'radios',  
'\#options' =\> array('yes' =\> t('Yes'), 'no' =\> t('No')),  
);  
\$form\['how\_much\_love'\] = array(  
'\#title' =\> t('Great! Tell us more:'),  
'\#type' =\> 'textfield',  
'\#states' =\> array(  
'visible' =\> array(  
':input\[name="drupal\_love"\]' =\> array('value' =\> 'yes'),  
),  
),  
);  
\$form\['haskids'\] = array(  
'\#type' =\> 'checkbox',  
'\#title' =\> t('Do you have children?'),  
);  
\$form\['kids\_container'\] = array(  
'\#type' =\> 'container',  
'\#states' =\> array(  
'invisible' =\> array('input\[name="haskids"\]' =\> array('checked' =\> FALSE),  
),  
),  
);  
\$form\['kids\_container'\]\['numkids'\] = array(  
'\#type' =\> 'textfield',  
'\#title' =\> t('How many?'),  
);

\$form\['gender'\] = array(  
'\#type' =\> 'select',  
'\#title' =\> t('Gender?'),  
'\#options' =\> array(  
'' =\> '-- gender --',  
'male' =\> 'Male',  
'female' =\> 'Female',  
),  
);  
\$form\['gender\_container\_male'\] = array(  
'\#type' =\> 'container',  
'\#states' =\> array('visible' =\> array('select\[name="gender"\]' =\> array('value' =\> 'male'),),),  
);  
\$form\['gender\_container\_female'\] = array(  
'\#type' =\> 'container',  
'\#states' =\> array('visible' =\> array('select\[name="gender"\]' =\> array('value' =\> 'female'),),),  
);  
\$form\['gender\_container\_male'\]\['male'\] = array(  
'\#type' =\> 'fieldset',  
'\#title' =\> t('Working?'),  
'work' =\> array(  
'\#type' =\> 'select',  
'\#options' =\> array('yes' =\> 'Yes', 'no' =\> 'No'),  
),  
);  
\$form\['gender\_container\_female'\]\['female'\] = array(  
'\#type' =\> 'fieldset',  
'\#title' =\> t('Female hair color?'),  
'hair\_color' =\> array(  
'\#title' =\> 'Hair color',  
'\#type' =\> 'select',  
'\#options' =\> array('black' =\> 'Black', 'red' =\> 'Red', 'white' =\> 'White'),  
'\#default\_value' =\> 'white',  
),  
);

// Ajax support  
\$form\['names\_fieldset'\] = array(  
'\#type' =\> 'fieldset',  
);  
\$form\['names\_fieldset'\]\['names'\] = array(  
'\#type' =\> 'container',  
'\#prefix' =\> '\<div id="names-fieldset-wrapper"\>',  
'\#suffix' =\> '\</div\>',  
);  
if (empty(\$form\_state\['num\_names'\]))  
\$form\_state\['num\_names'\] = 1;

for (\$i = 0; \$i \< \$form\_state\['num\_names'\]; \$i++) {  
\$form\['names\_fieldset'\]\['names'\]\['first\_name'\]\[\$i\] = array(  
'\#type' =\> 'textfield',  
'\#title' =\> 'Imię',  
);  
\$form\['names\_fieldset'\]\['names'\]\['last\_name'\]\[\$i\] = array(  
'\#type' =\> 'textfield',  
'\#title' =\> 'Nazwisko',  
);  
}  
\$form\['names\_fieldset'\]\['add\_name'\] = array(  
'\#type' =\> 'submit',  
'\#value' =\> t('Add one more'),  
'\#submit' =\> array('sajax\_add\_more\_add\_one'),

// See the examples in ajax\_example.module for more details on the  
// properties of \#ajax.  
'\#ajax' =\> array(  
'callback' =\> 'sajax\_add\_more\_callback',  
'wrapper' =\> 'names-fieldset-wrapper',  
),  
);  
if (\$form\_state\['num\_names'\] \> 1) {  
\$form\['names\_fieldset'\]\['remove\_name'\] = array(  
'\#type' =\> 'submit',  
'\#value' =\> t('Remove one'),  
'\#submit' =\> array('sajax\_add\_more\_remove\_one'),  
'\#ajax' =\> array(  
'callback' =\> 'sajax\_add\_more\_callback',  
'wrapper' =\> 'names-fieldset-wrapper',  
),  
);  
}

\$form\['submit'\] = array(  
'\#type' =\> 'submit',  
'\#value' =\> t('Save'),  
);

return \$form;  
}  
\[/code\]
